// api/generate-payment.js const crypto = require('crypto'); module.exports =
(req, res) => { // 1. CORS headers (Allows your browser to talk to the server)
res.setHeader('Access-Control-Allow-Credentials', true);
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods',
'GET,OPTIONS,PATCH,DELETE,POST,PUT'); res.setHeader(
'Access-Control-Allow-Headers', 'X-CSRF-Token, X-Requested-With, Accept,
Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version'
); // 2. Handle simple options request (Browser check) if (req.method ===
'OPTIONS') { res.status(200).end(); return; } // 3. Only allow POST for the
actual payment if (req.method !== 'POST') { return res.status(405).json({ error:
'Method not allowed' }); } try { const { amount, name, email } = req.body; //
Get secrets const projectid = process.env.PAYSERA_PROJECT_ID; const
sign_password = process.env.PAYSERA_PASSWORD; if (!projectid || !sign_password)
{ return res.status(500).json({ error: 'Server Config Error: Missing Environment
Variables' }); } // Prepare Paysera Data const amountInCents =
Math.round(parseFloat(amount) * 100); const orderid = 'BC-' + Date.now(); const
domain = 'https://www.bitcryptics.online'; const params = { projectid:
projectid, orderid: orderid, accepturl: `${domain}/success.html`, cancelurl:
`${domain}/payments.html`, version: '1.6', test: '0', p_firstname: name,
p_email: email, amount: amountInCents, currency: 'EUR', country: 'AL', payment:
'' }; // Sign Data const queryString = new URLSearchParams(params).toString();
const data = Buffer.from(queryString).toString('base64'); const sign =
crypto.createHash('md5').update(data + sign_password).digest('hex'); // Return
URL const redirectUrl =
`https://www.paysera.com/pay/?data=${data}&sign=${sign}`; res.status(200).json({
url: redirectUrl }); } catch (error) { console.error(error);
res.status(500).json({ error: 'Internal Server Error' }); } };
